"""创建发布说明文件"""
import datetime
from pathlib import Path

readme_content = f"""
═══════════════════════════════════════════════════════════
    槟榔视觉检测与切割定位系统 - 用户手册
    Betel Nut Vision Detection System
═══════════════════════════════════════════════════════════

版本: 1.0.0
构建日期: {datetime.datetime.now().strftime('%Y年%m月%d日')}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
一、系统要求
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

最低要求:
  ✓ Windows 10 64位 或 Windows 11
  ✓ 8GB 内存（推荐16GB）
  ✓ 磁盘空间: 5GB
  ✓ 分辨率: 1920x1080 或更高

推荐配置:
  ✓ NVIDIA GPU（支持CUDA 12.4）
  ✓ 16GB 内存
  ✓ SSD固态硬盘

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
二、安装步骤
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. 解压整个文件夹到任意位置（建议路径不含中文）
2. 双击 BetelNutVisionSystem.exe 运行程序
3. 首次运行可能需要Windows Defender允许运行

注意: 不要单独移动exe文件，必须保持完整文件夹结构！

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
三、GPU加速（可选）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

如果您有NVIDIA显卡并想使用GPU加速检测:

1. 检查显卡是否支持CUDA
2. 下载安装NVIDIA CUDA Toolkit 12.4
   官网: https://developer.nvidia.com/cuda-downloads
3. 安装完成后重启程序

如果没有GPU，程序会自动使用CPU模式运行（速度较慢）

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
四、运行模式
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

系统支持三种模式:

【模式1】真实硬件模式
  - 连接海康工业相机（IP: 192.168.1.110-117）
  - 连接PLC（IP: 192.168.3.10, Port: 502）
  - 实时采集图像并检测

【模式2】图片测试模式
  - 使用test_img文件夹中的图片
  - Mock PLC自动触发
  - 用于离线测试和验证

【模式3】完全Mock模式（默认）
  - 所有硬件Mock模拟
  - 自动生成测试数据
  - 用于演示和培训

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
五、配置说明
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

编辑 config.py 文件修改配置:

1. PLC配置
   PLC_CONFIG = {{
       'ip': '192.168.3.10',    # PLC IP地址
       'port': 502,             # Modbus端口
       'use_mock': True         # True=Mock模式, False=真实PLC
   }}

2. 相机配置
   在 CAMERA_CONFIGS 中修改每个相机的IP和寄存器地址

3. 触发间隔
   修改 mock_plc.py 中的 time.sleep(2, 5) 调整触发频率

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
六、界面说明
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

主窗口显示8个相机的实时状态:

每个相机显示:
  - 相机名称（Camera 1-8）
  - IP地址
  - 状态（待机/拍照中/计算中）
  - 实时图像（带检测框和切割线）
  - 检测参数（X/Y偏移、R角度、H高度）
  - 分类结果和置信度

底部日志区域显示系统运行日志

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
七、故障排除
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

问题1: 程序无法启动
解决:
  - 检查是否有杀毒软件拦截
  - 尝试以管理员权限运行
  - 检查Windows事件查看器

问题2: 检测速度很慢
解决:
  - 检查是否启用了GPU
  - 关闭其他占用资源的程序
  - 降低图像分辨率

问题3: 相机无法连接
解决:
  - 检查网络连接和IP配置
  - 确认相机电源和网线
  - 使用Mock模式测试程序功能

问题4: PLC通讯失败
解决:
  - 检查PLC IP和端口配置
  - 确认Modbus TCP服务已启用
  - 使用Mock PLC模式测试

问题5: YOLO模型加载失败
解决:
  - 确认models文件夹存在且包含.pt文件
  - 检查磁盘空间
  - 程序会自动降级到Mock检测

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
八、文件结构
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

BetelNutVisionSystem.exe  - 主程序（包含所有源代码）
config.py                  - 配置文件
models/                    - YOLO模型文件夹
  └─ betel_nut_obb_best.pt - 最佳OBB检测模型
test_img/                  - 测试图片文件夹
MvImport/                  - 海康SDK库
README_发布说明.txt        - 本文件

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
九、技术支持
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

如遇问题，请收集以下信息联系技术支持:
  - 系统版本（Windows版本）
  - GPU型号（如有）
  - 错误截图或日志
  - 配置文件内容

联系方式: 
  技术支持邮箱: support@areca.com

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
十、版权声明
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

本软件及其源代码受版权保护。
未经授权，禁止反编译、修改或分发。

Copyright © 2026 Areca. All rights reserved.

═══════════════════════════════════════════════════════════
"""

# 写入文件
output_path = Path("dist") / "README_发布说明.txt"
output_path.parent.mkdir(exist_ok=True)

with open(output_path, "w", encoding="utf-8") as f:
    f.write(readme_content)

print(f"✓ 发布说明已创建: {output_path}")
